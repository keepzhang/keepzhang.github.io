
 <!DOCTYPE HTML>
<html >
<head>
  <meta charset="UTF-8">
  
    <title>mysql双主复制及keepalived高可用 | 不会做饭的程序猿不是好架构狮</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=3, minimum-scale=1">
    
    <meta name="author" content="Keep zhang">
    
    <meta name="description" content="实验环境介绍


服务器名
IP地址
系统
Mysql
keepalived




node1
192.168.2.172
rhel-6.7
5.7.11
1.2.13


node2
192.168.2.173
rhel-6.7
5.7.11
1.2.13


VIP
192.168.2.254">
    
    
    
    
    
    <link rel="icon" href="/img/favicon.ico">
    
    
    <link rel="apple-touch-icon" href="/img/pacman.jpg">
    <link rel="apple-touch-icon-precomposed" href="/img/pacman.jpg">
    
    <link rel="stylesheet" href="/css/style.css">
	
<script type="text/javascript">
#���İٶ�ͳ�ƴ���
</script>

</head>

  <body>
    <header>
      <div>
		
			<div id="imglogo">
				<a href="/"><img src="/img/logo.png" alt="不会做饭的程序猿不是好架构狮" title="不会做饭的程序猿不是好架构狮"/></a>
			</div>
			
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="不会做饭的程序猿不是好架构狮">不会做饭的程序猿不是好架构狮</a></h1>
				<h2 class="blog-motto"></h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="Menu">
			</a></div>
			<nav class="animated">
				<ul>
					
						<li><a href="/">主页</a></li>
					
						<li><a href="/archives">归档</a></li>
					
					<li>
					
					<form class="search" action="//google.com/search" method="get" accept-charset="utf-8">
						<label>Search</label>
						<input type="text" id="search" name="q" autocomplete="off" maxlength="20" placeholder="Search" />
						<input type="hidden" name="q" value="site:keepzhang.github.io">
					</form>
					
					</li>
				</ul>
			</nav>			
</div>

    </header>
    <div id="container">
      <div id="main" class="post" itemscope itemprop="blogPost">
	<article itemprop="articleBody"> 
		<header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/04/13/mysql双主复制及keepalived高可用/" title="mysql双主复制及keepalived高可用" itemprop="url">mysql双主复制及keepalived高可用</a>
  </h1>
  <p class="article-author">By
    
      <a href="http://keepzhang.github.io" title="Keep zhang">Keep zhang</a>
    </p>
  <p class="article-time">
    <time datetime="2016-04-13T00:44:37.000Z" itemprop="datePublished">2016-04-13</time>
    Updated:<time datetime="2016-04-13T06:04:55.273Z" itemprop="dateModified">2016-04-13</time>
    
  </p>
</header>
	<div class="article-content">
		
		
		<div id="toc" class="toc-article">
			<strong class="toc-title">Contents</strong>
		<ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#实验环境介绍"><span class="toc-number">1.</span> <span class="toc-text">实验环境介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1、mysql-yum安装"><span class="toc-number">2.</span> <span class="toc-text">1、mysql yum安装</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1-Adding-the-MySQL-Yum-Repository"><span class="toc-number">2.1.</span> <span class="toc-text">1.1 Adding the MySQL Yum Repository</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-Selecting-a-Release-Series"><span class="toc-number">2.2.</span> <span class="toc-text">1.2 Selecting a Release Series</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3-Installing-MySQL"><span class="toc-number">2.3.</span> <span class="toc-text">1.3 Installing MySQL</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-mysql双主复制"><span class="toc-number">3.</span> <span class="toc-text">2 mysql双主复制</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-创建同步用户"><span class="toc-number">3.1.</span> <span class="toc-text">2.1 创建同步用户</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-修改-etc-my-cnf-配置文件-为其添加以下内容"><span class="toc-number">3.2.</span> <span class="toc-text">2.2 修改 /etc/my.cnf 配置文件,为其添加以下内容:</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-分别重启服务器node1、node2上的mysql服务"><span class="toc-number">3.3.</span> <span class="toc-text">2.3 分别重启服务器node1、node2上的mysql服务</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-4-分别在服务器node1、node2上查看做为主服务器状态"><span class="toc-number">3.4.</span> <span class="toc-text">2.4 分别在服务器node1、node2上查看做为主服务器状态</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-5-分别在服务器node1、node2上用change-master语句指定同步位置"><span class="toc-number">3.5.</span> <span class="toc-text">2.5 分别在服务器node1、node2上用change master语句指定同步位置 :</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-6-分别在服务器node1、node2上启动从服务器线程"><span class="toc-number">3.6.</span> <span class="toc-text">2.6 分别在服务器node1、node2上启动从服务器线程</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-7-测试"><span class="toc-number">3.7.</span> <span class="toc-text">2.7 测试</span></a></li></ol></li></ol>
		</div>
		
		<hr>
<h3 id="实验环境介绍"><a href="#实验环境介绍" class="headerlink" title="实验环境介绍"></a>实验环境介绍</h3><table>
<thead>
<tr>
<th>服务器名</th>
<th style="text-align:right">IP地址</th>
<th style="text-align:center">系统</th>
<th>Mysql</th>
<th>keepalived</th>
</tr>
</thead>
<tbody>
<tr>
<td>node1</td>
<td style="text-align:right">192.168.2.172</td>
<td style="text-align:center">rhel-6.7</td>
<td>5.7.11</td>
<td>1.2.13</td>
</tr>
<tr>
<td>node2</td>
<td style="text-align:right">192.168.2.173</td>
<td style="text-align:center">rhel-6.7</td>
<td>5.7.11</td>
<td>1.2.13</td>
</tr>
<tr>
<td>VIP</td>
<td style="text-align:right">192.168.2.254</td>
<td style="text-align:center"></td>
<td></td>
</tr>
</tbody>
</table>
<hr>
<h3 id="1、mysql-yum安装"><a href="#1、mysql-yum安装" class="headerlink" title="1、mysql yum安装"></a>1、mysql yum安装</h3><p>mysql下载链接<a href="http://dev.mysql.com/downloads/mysql/" target="_blank" rel="external">http://dev.mysql.com/downloads/mysql/</a></p>
<p>Download MySQL Yum Repository<a href="http://dev.mysql.com/downloads/repo/yum/" target="_blank" rel="external">http://dev.mysql.com/downloads/repo/yum/</a></p>
<p><img src="http://7xs8rn.com1.z0.glb.clouddn.com/mysql%20yum%20repository.png" alt=""></p>
<p><img src="http://7xs8rn.com1.z0.glb.clouddn.com/quick%20guide.png" alt=""></p>
<p>A Quick Guide to Using the MySQL Yum Repository<a href="http://dev.mysql.com/doc/mysql-yum-repo-quick-guide/en/" target="_blank" rel="external">http://dev.mysql.com/doc/mysql-yum-repo-quick-guide/en/</a></p>
<h4 id="1-1-Adding-the-MySQL-Yum-Repository"><a href="#1-1-Adding-the-MySQL-Yum-Repository" class="headerlink" title="1.1 Adding the MySQL Yum Repository"></a>1.1 Adding the MySQL Yum Repository</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">a. Go to the download page for MySQL Yum repository at http://dev.mysql.com/downloads/repo/yum/.</span><br><span class="line">b. Select and download the release package for your platform.</span><br><span class="line">c. Install the downloaded release package with the following command, replacing platform-and-version-specific-package-name with the name of the downloaded package:</span><br><span class="line">shell&gt; sudo rpm -Uvh platform-and-version-specific-package-name.rpm</span><br><span class="line">For example, for version n of the package for EL6-based systems, the command is:</span><br><span class="line">shell&gt; sudo rpm -Uvh mysql57-community-release-el6-n.noarch.rpm</span><br></pre></td></tr></table></figure>
<h4 id="1-2-Selecting-a-Release-Series"><a href="#1-2-Selecting-a-Release-Series" class="headerlink" title="1.2 Selecting a Release Series"></a>1.2 Selecting a Release Series</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">When using the MySQL Yum repository, the latest GA release of MySQL is selected for installation by default. If this is what you want, you can skip to the next step,Installing MySQL with Yum.</span><br><span class="line">Within the MySQL Yum repository (http://repo.mysql.com/yum/), different release series of the MySQL Community Server are hosted in different subrepositories. The subrepository for the latest GA series (currently MySQL 5.7) is enabled by default, and the subrepositories for all other series (for example, the MySQL 5.6 series) are disabled by default. Use this command to see all the subrepositories in the MySQL Yum repository, and see which of them are enabled or disabled (for dnf-enabled systems, replace yum in the command with dnf):</span><br><span class="line">shell&gt; yum repolist all | grep mysql</span><br><span class="line">To install the latest release from the latest GA series, no configuration is needed. To install the latest release from a specific series other than the latest GA series, disable the subrepository for the latest GA series and enable the subrepository for the specific series before running the installation command. You can do that by editing manually the /etc/yum.repos.d/mysql-community.repo file. This is a typical entry for a release series&apos; subrepository in the file:</span><br><span class="line">[mysql57-community]</span><br><span class="line">name=MySQL 5.7 Community Server</span><br><span class="line">baseurl=http://repo.mysql.com/yum/mysql-5.7-community/el/6/$basearch/</span><br><span class="line">enabled=1</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-mysql</span><br><span class="line">Find the entry for the subrepository you want to configure, and edit the enabled option. Specify enabled=0 to disable a subrepository, or enabled=1 to enable a subrepository. For example, to install MySQl 5.6, make sure you have enabled=0 for the above subrepository entry for MySQL 5.7, and have enabled=1 for the entry for the 5.6 series:</span><br><span class="line"># Enable to use MySQL 5.6</span><br><span class="line">[mysql56-community]</span><br><span class="line">name=MySQL 5.6 Community Server</span><br><span class="line">baseurl=http://repo.mysql.com/yum/mysql-5.6-community/el/6/$basearch/</span><br><span class="line">enabled=1</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-mysql</span><br><span class="line">You should only enable subrepository for one release series at any time. When subrepositories for more than one release series are enabled, the latest series will be used by Yum.</span><br><span class="line">Verify that the correct subrepositories have been enabled and disabled by running the following command and checking its output (for dnf-enabled systems, replaceyum in the command with dnf):</span><br><span class="line">shell&gt; yum repolist enabled | grep mysql</span><br></pre></td></tr></table></figure>
<h4 id="1-3-Installing-MySQL"><a href="#1-3-Installing-MySQL" class="headerlink" title="1.3 Installing MySQL"></a>1.3 Installing MySQL</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">Install MySQL by the following command (for dnf-enabled systems, replace yum in the command with dnf):</span><br><span class="line">shell&gt; sudo yum install mysql-community-server</span><br><span class="line">This installs the package for the MySQL server, as well as other required packages.</span><br><span class="line">Starting the MySQL Server</span><br><span class="line"></span><br><span class="line">Start the MySQL server with the following command:</span><br><span class="line">shell&gt; sudo service mysqld start</span><br><span class="line">You can check the status of the MySQL server with the following command:</span><br><span class="line">shell&gt; sudo service mysqld status</span><br><span class="line">For MySQL 5.7 only: At the initial start up of the server, the following happens, given that the data directory of the server is empty:</span><br><span class="line">The server is initialized.</span><br><span class="line">An SSL certificate and key files are generated in the data directory.</span><br><span class="line">The validate_password plugin is installed and enabled.</span><br><span class="line">A superuser account &apos;root&apos;@&apos;localhost&apos; is created. A password for the superuser is set and stored in the error log file. To reveal it, use the following command:</span><br><span class="line">shell&gt; sudo grep &apos;temporary password&apos; /var/log/mysqld.log</span><br><span class="line">Change the root password as soon as possible by logging in with the generated, temporary password and set a custom password for the superuser account:</span><br><span class="line">shell&gt; mysql -uroot -p </span><br><span class="line">mysql&gt; ALTER USER &apos;root&apos;@&apos;localhost&apos; IDENTIFIED BY &apos;MyNewPass4!&apos;;</span><br></pre></td></tr></table></figure>
<h3 id="2-mysql双主复制"><a href="#2-mysql双主复制" class="headerlink" title="2 mysql双主复制"></a>2 mysql双主复制</h3><p> 假设要同步的库是test</p>
<h4 id="2-1-创建同步用户"><a href="#2-1-创建同步用户" class="headerlink" title="2.1 创建同步用户"></a>2.1 创建同步用户</h4><p>在node1上<br>mysql&gt; grant replication slave on <em>.</em> to ‘sync’@’192.168.2.173’ identified by ‘ShenZhou_CJ3;<br>Query OK, 0 rows affected (0.00 sec)<br>mysql&gt; flush privileges;<br>Query OK, 0 rows affected (0.00 sec)<br>在node2 上<br>mysql&gt; grant replication slave on <em>.</em> to ‘sync’@’192.168.2.172’ identified by ‘ShenZhou_CJ3’;<br>Query OK, 0 rows affected (0.11 sec)<br>mysql&gt; flush privileges;<br>Query OK, 0 rows affected (0.00 sec)</p>
<h4 id="2-2-修改-etc-my-cnf-配置文件-为其添加以下内容"><a href="#2-2-修改-etc-my-cnf-配置文件-为其添加以下内容" class="headerlink" title="2.2 修改 /etc/my.cnf 配置文件,为其添加以下内容:"></a>2.2 修改 /etc/my.cnf 配置文件,为其添加以下内容:</h4><p>在 node1上<br>[mysqld]<br>server-id=1  #数据同步时用于标识该语句最初是从哪个server写入的，进行主主或主备搭建时，都需填写<br>log-bin=mysql-bin<br>binlog-do-db=db_rocky #需要记录进制日志的数据库.如果有多个数据库可用逗号分隔,或者使用多个binlog-do-db选项<br>binlog-ignore-db=mysql #不需要记录进制日志的数据库.如果有多个数据库可用逗号分隔,或者使用多个binlog-do-db选项<br>replicate-do-db=db_rocky #需要进行同步的数据库.如果有多个数据库可用逗号分隔,或者使用多个replicate-do-db选项<br>replicate-ignore-db=mysql,information_schema #不需要同步的数据库.如果有多个数据库可用逗号分隔,或者使用多个replicate-ignore-db选项</p>
<p>#同步参数:</p>
<p>#保证slave挂在任何一台master上都会接收到另一个master的写入信息<br>log-slave-updates<br>sync_binlog=1<br>auto_increment_offset=1<br>auto_increment_increment=2<br>slave-skip-errors=all #过滤掉一些没啥大问题的错误<br>在 node2上<br>[mysqld]<br>server-id=2 #设置一个不同的id、注意这里在my.cnf里面有个默认值是 1 、把默认值改掉、而不能新增一个server-id<br>log-bin=mysql-bin<br>binlog-do-db=db_rocky #需要记录二进制日志的数据库.如果有多个数据库可用逗号分隔,或者使用多个binlog-do-db选项<br>binlog-ignore-db=mysql #不需要记录进制日志的数据库.如果有多个数据库可用逗号分隔,或者使用多个binlog-ignore-db选项</p>
<p>#需要同步的数据库<br>replicate-do-db=db_rocky #需要进行同步的数据库.如果有多个数据库可用逗号分隔,或者使用多个binlog-do-db选项<br>replicate-ignore-db=mysql,information_schema #不需要同步的数据库.如果有多个数据库可用逗号分隔,或者使用多个binlog-do-db选项</p>
<p>**同步参数:</p>
<p>**保证slave挂在任何一台master上都会接收到另一个master的写入信息<br>log-slave-updates<br>sync_binlog=1<br>auto_increment_offset=2<br>auto_increment_increment=2<br>slave-skip-errors=all #过滤掉一些没啥大问题的错误</p>
<h4 id="2-3-分别重启服务器node1、node2上的mysql服务"><a href="#2-3-分别重启服务器node1、node2上的mysql服务" class="headerlink" title="2.3 分别重启服务器node1、node2上的mysql服务"></a>2.3 分别重启服务器node1、node2上的mysql服务</h4><h4 id="2-4-分别在服务器node1、node2上查看做为主服务器状态"><a href="#2-4-分别在服务器node1、node2上查看做为主服务器状态" class="headerlink" title="2.4 分别在服务器node1、node2上查看做为主服务器状态"></a>2.4 分别在服务器node1、node2上查看做为主服务器状态</h4><p>在node1<br>mysql&gt; flush tables with read lock;#防止进入新的数据<br>Query OK, 0 rows affected (0.00 sec)<br>mysql&gt; show master status\G     #不带分号，否则报错ERROR: No query specified<br><strong><strong><strong><strong><strong><strong>*</strong></strong></strong></strong></strong></strong> 1. row <strong><strong><strong><strong><strong><strong><em>*</em></strong></strong></strong></strong></strong></strong><br>                   File: mysql-bin.000006<br>         Position: 1050<br>     Binlog_Do_DB: test<br> Binlog_Ignore_DB: mysql,information_schema,performance_schema,sys<br>Executed_Gtid_Set:<br>1 row in set (0.00 sec)<br>在node2<br>mysql&gt; flush tables with read lock;<br>Query OK, 0 rows affected (0.00 sec)<br>mysql&gt; show master status\G    #不带分号，否则报错ERROR: No query specified<br><strong><strong><strong><strong><strong><strong><em>*</em></strong></strong></strong></strong></strong></strong> 1. row <strong><strong><strong><strong><strong><strong><em>*</em></strong></strong></strong></strong></strong></strong><br>           File: mysql-bin.000003<br>         Position: 1068<br>     Binlog_Do_DB: test<br> Binlog_Ignore_DB: mysql,information_schema,performance_schema,sys<br>Executed_Gtid_Set:<br>1 row in set (0.01 sec)</p>
<h4 id="2-5-分别在服务器node1、node2上用change-master语句指定同步位置"><a href="#2-5-分别在服务器node1、node2上用change-master语句指定同步位置" class="headerlink" title="2.5 分别在服务器node1、node2上用change master语句指定同步位置 :"></a>2.5 分别在服务器node1、node2上用change master语句指定同步位置 :</h4><p>在node1<br>如果已经start slave,需要执行stop slave;,并且unlock tables;<br>否则会出现如下错误：<br>ERROR 3021 (HY000): This operation cannot be performed with a running slave io thread; run STOP SLAVE IO_THREAD FOR CHANNEL ‘’ first.<br>ERROR 1192 (HY000): Can’t execute the given command because you have active locked tables or an active transaction</p>
<p>mysql&gt; change master to master_host=’192.168.2.173’,master_user=’sync’,master_password=’ShenZhen_CJ3’,<br>    -&gt; master_log_file=’mysql-bin.000003’,master_log_pos=1068;   #对接点的信息<br>Query OK, 0 rows affected (0.05 sec)<br>在node2<br>如果已经start slave,需要执行stop slave;,并且unlock tables;<br>mysql&gt; change master to master_host=’192.168.2.172’,master_user=’sync’,master_password=’ShenZhou_CJ3’,<br>    -&gt; master_log_file=’mysql-bin.000006,master_log_pos=1050;<br>Query OK, 0 rows affected (0.15 sec)<br>注：master_log_file，master_log_pos由上面主服务器查出的状态值中确定<br>master_log_file对应File，master_log_pos对应Position<br>在node1、node2上<br>mysql&gt; unlock tables;<br>Query OK, 0 rows affected (0.00 sec)</p>
<h4 id="2-6-分别在服务器node1、node2上启动从服务器线程"><a href="#2-6-分别在服务器node1、node2上启动从服务器线程" class="headerlink" title="2.6 分别在服务器node1、node2上启动从服务器线程"></a>2.6 分别在服务器node1、node2上启动从服务器线程</h4><p>mysql&gt; start slave;<br>Query OK, 0 rows affected (0.00 sec)<br>分别在服务器node1、node2上查看从服务器状态 :<br>node1上<br>mysql&gt; show slave status\G<br><strong><strong><strong><strong><strong><strong><em>*</em></strong></strong></strong></strong></strong></strong> 1. row <strong><strong><strong><strong><strong><strong><em>*</em></strong></strong></strong></strong></strong></strong><br>主要关注以下 2 个参数：<br>…<br>…<br>            Slave_IO_Running: Yes<br>            Slave_SQL_Running: Yes<br>…<br>…</p>
<p>node2上：<br>mysql&gt; show slave status\G<br><strong><strong><strong><strong><strong><strong><em>*</em></strong></strong></strong></strong></strong></strong> 1. row <strong><strong><strong><strong><strong><strong><em>*</em></strong></strong></strong></strong></strong></strong><br>主要关注以下 2 个参数：<br>…<br>…<br>            Slave_IO_Running: Yes<br>            Slave_SQL_Running: Yes<br>…</p>
<p>在测试中出现Slave_IO_Running: No Slave_SQL_Running: Yes  Seconds_Behind_Master: NULL情况<br>排查过程为：查看mysql日志文件 tail -f /var/log/mysqld.log<br>发现报错信息[ERROR] Slave I/O for channel ‘’: Fatal error: The slave I/O thread stops because master and slave have equal MySQL server UUIDs; these UUIDs must be different for replication to work. Error_code: 1593<br>1、错误消息<br>mysql&gt; show slave staus;</p>
<p>Last_IO_Error: Fatal error: The slave I/O thread stops because master and slave have equal MySQL server UUIDs;<br>these UUIDs must be different for replication to work.</p>
<p>2、查看主从的server_id变量<br>node1&gt; show variables like ‘server_id’;<br>+—————+——-+<br>| Variable_name | Value |<br>+—————+——-+<br>| server_id    | 1|<br>+—————+——-+<br>node2&gt; show variables like ‘server_id’;<br>+—————+——-+<br>| Variable_name | Value |<br>+—————+——-+<br>| server_id    |2    |<br>+—————+——-+<br>– 从上面的情形可知，主从mysql已经使用了不同的server_id<br>3、解决故障</p>
<p>###查看auto.cnf文件<br>[root@node1~]#more /usr/local/mysql/auto.cnf  ### 主上的uuid<br>[auto]<br>server-uuid=615fecec-fe27-11e5-b7ec-000c29d5bb93<br>[root@node2~]#more /usr/local/mysql/auto.cnf  ###从上的uuid，果然出现了重复，原因是克隆了虚拟机，只改server_id不行<br>[auto]<br>server-uuid=615fecec-fe27-11e5-b7ec-000c29d5bb93<br>[root@node2~]# mv /usr/local/mysql/auto.cnf  /usr/local/mysql/auto.cnf.bk  ###重命名该文件<br>[root@node2~]# service mysql restart          ###重启mysql<br>Shutting down MySQL.[  OK  ]<br>Starting MySQL.[  OK  ]<br>[root@node2~]#more /usr/local/mysql/auto.cnf  ###重启后自动生成新的auto.cnf文件，即新的UUID<br>[auto]<br>server-uuid=37ea8741-00bd-11e6-bcdb-000c294d8f22<br>[root@node1~]# service mysql restart          ###重启mysql<br>Shutting down MySQL.[  OK  ]<br>Starting MySQL.[  OK  ]</p>
<p>###再次查看l两节点slave的状态已经正常<br>[root@noss2~]#<br>            Slave_IO_Running: Yes<br>            Slave_SQL_Running: Yes<br>            Seconds_Behind_Master: 0<br>[root@noss1~]#<br>            Slave_IO_Running: Yes<br>            Slave_SQL_Running: Yes<br>            Seconds_Behind_Master: 0</p>
<h4 id="2-7-测试"><a href="#2-7-测试" class="headerlink" title="2.7 测试"></a>2.7 测试</h4><p>node2上<br>mysql&gt; show databases;<br>+——————–+<br>| Database           |<br>+——————–+<br>| information_schema |<br>| mysql              |<br>| performance_schema |<br>| sys                |<br>| test               |<br>+——————–+<br>5 rows in set (0.00 sec)<br>mysql&gt; use test;<br>Database changed<br>mysql&gt; show tables;<br>+—————-+<br>| Tables_in_test |<br>+—————-+<br>| test1          |<br>+—————-+<br>1 row in set (0.00 sec)<br>mysql&gt; create table sync (id int);<br>Query OK, 0 rows affected (0.23 sec)<br>mysql&gt;insert into sync values(1);<br>Query OK, 1 row affected (0.09 sec)<br>mysql&gt; commit;<br>Query OK, 0 rows affected (0.01 sec)</p>
<p>在 node1上<br>mysql&gt; show tables;<br>+—————-+<br>| Tables_in_test |<br>+—————-+<br>| sync           |<br>+—————-+<br>2 rows in set (0.00 sec)<br>mysql&gt; select * from sync;<br>+——+<br>| id  |<br>+——+<br>|    1 |<br>+——+<br>1 row in set (0.00 sec)</p>
  
	</div>
		<footer class="article-footer clearfix">




<div class="article-share" id="share">

  <div data-url="http://keepzhang.github.io/2016/04/13/mysql双主复制及keepalived高可用/" data-title="mysql双主复制及keepalived高可用 | 不会做饭的程序猿不是好架构狮" data-tsina="null" class="share clearfix">
  </div>

</div>
</footer>   	       
	</article>
	
<nav class="article-nav clearfix">
 

<div class="next">
<a href="/2016/03/31/python入门基础/"  title="python入门基础">
 <strong>NEXT:</strong><br/> 
 <span>python入门基础
</span>
</a>
</div>

</nav>

	
</div>  
      <div class="openaside"><a class="navbutton" href="#" title="Show Sidebar"></a></div>

  <div id="toc" class="toc-aside">
  <strong class="toc-title">Contents</strong>
  <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#实验环境介绍"><span class="toc-number">1.</span> <span class="toc-text">实验环境介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1、mysql-yum安装"><span class="toc-number">2.</span> <span class="toc-text">1、mysql yum安装</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1-Adding-the-MySQL-Yum-Repository"><span class="toc-number">2.1.</span> <span class="toc-text">1.1 Adding the MySQL Yum Repository</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-Selecting-a-Release-Series"><span class="toc-number">2.2.</span> <span class="toc-text">1.2 Selecting a Release Series</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3-Installing-MySQL"><span class="toc-number">2.3.</span> <span class="toc-text">1.3 Installing MySQL</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-mysql双主复制"><span class="toc-number">3.</span> <span class="toc-text">2 mysql双主复制</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-创建同步用户"><span class="toc-number">3.1.</span> <span class="toc-text">2.1 创建同步用户</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-修改-etc-my-cnf-配置文件-为其添加以下内容"><span class="toc-number">3.2.</span> <span class="toc-text">2.2 修改 /etc/my.cnf 配置文件,为其添加以下内容:</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-分别重启服务器node1、node2上的mysql服务"><span class="toc-number">3.3.</span> <span class="toc-text">2.3 分别重启服务器node1、node2上的mysql服务</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-4-分别在服务器node1、node2上查看做为主服务器状态"><span class="toc-number">3.4.</span> <span class="toc-text">2.4 分别在服务器node1、node2上查看做为主服务器状态</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-5-分别在服务器node1、node2上用change-master语句指定同步位置"><span class="toc-number">3.5.</span> <span class="toc-text">2.5 分别在服务器node1、node2上用change master语句指定同步位置 :</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-6-分别在服务器node1、node2上启动从服务器线程"><span class="toc-number">3.6.</span> <span class="toc-text">2.6 分别在服务器node1、node2上启动从服务器线程</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-7-测试"><span class="toc-number">3.7.</span> <span class="toc-text">2.7 测试</span></a></li></ol></li></ol>
  </div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="Hide Sidebar"></a></div>
<aside class="clearfix">

  

  

  <div class="rsspart">
	<a href="null" target="_blank" title="rss">RSS</a>
</div>

</aside>
</div>
    </div>
    <footer><div id="footer" >
	
	<div class="line">
		<span></span>
		<div class="author"></div>
	</div>
	
	
	<section class="info">
		<p> Hi,i&#39;m keepzhang,this&#39;s my blog. <br/>
			welcome  you to access my geek home!!!</p>
	</section>
	 
	<div class="social-font clearfix">
		
		
		
		<a href="https://github.com/keepzhang" target="_blank" title="github"></a>
		
		
		
	</div>
		<p class="copyright">Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/A-limon/pacman" target="_blank" title="Pacman">Pacman</a> © 2016 
		
		<a href="http://keepzhang.github.io" target="_blank" title="Keep zhang">Keep zhang</a>
		
		</p>
</div>
</footer>
    <script src="/js/jquery-2.1.0.min.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else
    {
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
      
      $('#toc.toc-aside').css('display', 'none');
        
    }
  });
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
});
</script>

<script type="text/javascript">
$(document).ready(function(){ 
  var ai = $('.article-content>iframe'),
      ae = $('.article-content>embed'),
      t  = $('#toc'),
      h  = $('article h2')
      ah = $('article h2'),
      ta = $('#toc.toc-aside'),
      o  = $('.openaside'),
      c  = $('.closeaside');
  if(ai.length>0){
    ai.wrap('<div class="video-container" />');
  };
  if(ae.length>0){
   ae.wrap('<div class="video-container" />');
  };
  if(ah.length==0){
    t.css('display','none');
  }else{
    c.click(function(){
      ta.css('display', 'block').addClass('fadeIn');
    });
    o.click(function(){
      ta.css('display', 'none');
    });
    $(window).scroll(function(){
      ta.css("top",Math.max(140,320-$(this).scrollTop()));
    });
  };
});
</script>


<script type="text/javascript">
$(document).ready(function(){ 
  var $this = $('.share'),
      url = $this.attr('data-url'),
      encodedUrl = encodeURIComponent(url),
      title = $this.attr('data-title'),
      tsina = $this.attr('data-tsina');
  var html = [
  '<a href="#" class="overlay" id="qrcode"></a>',
  '<div class="qrcode clearfix"><span>扫描二维码分享到微信朋友圈</span><a class="qrclose" href="#share"></a><strong>Loading...Please wait</strong><img id="qrcode-pic" data-src="http://s.jiathis.com/qrcode.php?url=' + encodedUrl + '"/></div>',
  '<a href="#textlogo" class="article-back-to-top" title="Top"></a>',
  '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
  '<a href="#qrcode" class="article-share-qrcode" title="QRcode"></a>',
  '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
  '<a href="http://service.weibo.com/share/share.php?title='+title+'&url='+encodedUrl +'&ralateUid='+ tsina +'&searchPic=true&style=number' +'" class="article-share-weibo" target="_blank" title="Weibo"></a>',
  '<span title="Share to"></span>'
  ].join('');
  $this.append(html);
  $('.article-share-qrcode').click(function(){
    var imgSrc = $('#qrcode-pic').attr('data-src');
    $('#qrcode-pic').attr('src', imgSrc);
    $('#qrcode-pic').load(function(){
        $('.qrcode strong').text(' ');
    });
  });
});     
</script>




<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.article-content').each(function(i){
    $(this).find('img').each(function(){
      if ($(this).parent().hasClass('fancybox')) return;
      var alt = this.alt;
      if (alt) $(this).after('<span class="caption">' + alt + '</span>');
      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox"></a>');
    });
    $(this).find('.fancybox').each(function(){
      $(this).attr('rel', 'article' + i);
    });
  });
  if($.fancybox){
    $('.fancybox').fancybox();
  }
}); 
</script>


<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-75633118-1', 'auto');  
ga('send', 'pageview');
</script>


  </body>
</html>
